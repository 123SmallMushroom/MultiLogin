import org.apache.tools.ant.filters.ReplaceTokens

allprojects {
    apply plugin: "java"
}

subprojects {
    repositories {
        mavenCentral()
    }
    dependencies {
        compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.20'
        annotationProcessor group: 'org.projectlombok', name: 'lombok', version: '1.18.20'

        implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.14.1'
        implementation group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.14.1'
        implementation group: 'com.zaxxer', name: 'HikariCP', version: '4.0.3'
        implementation group: 'mysql', name: 'mysql-connector-java', version: '8.0.25'
        implementation group: 'com.h2database', name: 'h2', version: '1.4.200'
        implementation group: 'com.google.code.gson', name: 'gson', version: '2.8.8'
        implementation group: 'org.yaml', name: 'snakeyaml', version: '1.29'

    }

    String env;
    String ver;

    processResources {
        env = System.getProperty("env", "AUTO")
        if (env.toLowerCase() == "final") {
            ver = (project.plugin_version as String)
        } else {
            ver = "Build_" + ((System.currentTimeMillis() / 1000) as int)
        }

        setDuplicatesStrategy(DuplicatesStrategy.EXCLUDE)
        filter ReplaceTokens, tokens: [
                "version": ver,
                "author" : 'ksqeib, CaaMoe',
        ]
    }

    jar {
        env = System.getProperty("env", "AUTO")
        if (env.toLowerCase() == "final") {
            ver = (project.plugin_version as String)
        } else {
            ver = "Build_" + ((System.currentTimeMillis() / 1000) as int)
        }

        manifest.attributes(
                "Build-Timestamp": System.currentTimeMillis(),
                "MultiLogin-Version": ver,
                "MultiLogin-Build-Type": env
        )
    }
}